<mat-toolbar>
	<mat-form-field style="width: 100%; margin-bottom: -1.25em">
		<mat-label>Database to import files</mat-label>
		<input #database
			   [value]="selectedDatabase.name"
			   autocomplete="off"
			   matInput
			   required>
	</mat-form-field>

	<button
		matTooltip="Drop your files here"
		matTooltipPosition="left"
		mat-icon-button>
		<span class="material-symbols-outlined">
			place_item
		</span>
	</button>
</mat-toolbar>

<div fxLayout="column" fxLayoutAlign="space-between center" style="padding: 20px">

	<div fxFill>
		<input #inputFile (change)="inputChange($event)" accept="{{acceptedExt.join(', ')}}" hidden="true" multiple
			   onclick="this.value=null" type="file"/>
		<button
			fxFill
			(click)="inputFile.click()"
			color="accent"
			mat-stroked-button>
			<span class="material-symbols-outlined notranslate">
				upload_file
			</span>
			Choose [{{acceptedExt.join(', ')}}] files
		</button>
	</div>

	<mat-card *ngFor="let file of files; let i = index">
		<mat-card-header>
			<mat-form-field
				appearance="outline"
				style="flex: 1; margin-bottom: -1em">
				<mat-label>File name</mat-label>
				<input [(ngModel)]="file.name"
					   autocomplete="off"
					   matInput
					   required>
			</mat-form-field>

			<button
				(click)="files.splice(i, 1)"
				mat-icon-button>
					<span class="material-symbols-outlined notranslate">
						remove
					</span>
			</button>
		</mat-card-header>

		<mat-card-content>
			<ngx-monaco-editor
				*ngIf="files[i].text.length < 10000000"
				[(ngModel)]="files[i].text"
				[options]="files[i].editorOptions">
			</ngx-monaco-editor>
			<mat-progress-bar
				[color]="file.progress < 0 ? 'warn' : 'accent'"
				[value]="file.progress"
				style="margin-top: 8px"
				mode="determinate"></mat-progress-bar>
		</mat-card-content>
	</mat-card>

	<mat-divider style="width: 100%; margin: 10px 0px"></mat-divider>

	<div fxFlexFill fxLayout="row" fxLayoutAlign="space-between center">
		<button
			(click)="files = []"
			[disabled]="files.length < 1"
			mat-button>
			Clear All
		</button>

		<button
			(click)="importFiles(database.value)"
			*ngIf="!isLoading"
			[disabled]="files.length < 1"
			color="accent"
			mat-raised-button>
			<span class="material-symbols-outlined notranslate">
				exit_to_app
			</span>
			Load Files
		</button>

		<mat-spinner
			*ngIf="isLoading"
			[diameter]="30"
			color="accent"
		></mat-spinner>
	</div>
</div>
