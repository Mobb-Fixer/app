<mat-toolbar
	*ngIf="selectedPatch"
	fxLayout="row"
	fxLayoutAlign="space-between center">

	<div style="display: flex; gap: 26px; font-size: 16px; align-items: center;">
		<span>
			{{selectedPatch.time | date:'MM-dd HH:mm:ss'}}
		</span>

		<button
			(click)="snackBar.open('Hash copied', 'â¨‰', {duration: 3000})"
			[cdkCopyToClipboard]="selectedPatch.hash"
			mat-button>
			<span class="material-symbols-outlined notranslate">
				tag
			</span>
			{{ selectedPatch.hash | slice:0:6 }}
		</button>
	</div>

	<div *ngIf="!selectedPatch.isLoading">
		<button
			(click)="reset(selectedPatch)"
			[disabled]="isResetting"
			color="accent"
			mat-stroked-button>
			<span class="material-symbols-outlined notranslate">
				restart_alt
			</span>
			Reset
		</button>
	</div>

</mat-toolbar>

<mat-progress-bar
	*ngIf="isLoading"
	color="accent"
	mode="indeterminate"
	style="position: absolute; left: 0px; right: 0px; z-index: 10000000">
</mat-progress-bar>

<div style="height: calc(100vh - 56px); overflow: auto;">

	<mat-card *ngIf="selectedDatabase?.system || selectedServer?.wrapper === 'CockroachDB'">
		<mat-card-header>
			<mat-card-subtitle>
				<mat-error>
					<br>
					Database Versioning is not available for {{ selectedServer?.wrapper }}
				</mat-error>
			</mat-card-subtitle>
		</mat-card-header>
	</mat-card>

	<ng-container *ngIf="!selectedDatabase?.system && selectedServer?.wrapper !== 'CockroachDB'">

		<mat-card
			*ngIf="patches.length < 1">
			<mat-card-header>
				<mat-card-subtitle>
					<br>
					No version yet, make a modification to your database to see one
				</mat-card-subtitle>
			</mat-card-header>
		</mat-card>

		<mat-tab-group
			(selectedTabChange)="selectedPatch = patches[$event.index]; loadDiff()">
			<mat-tab
				*ngFor="let patch of patches; trackBy:identify"
				[label]="patch.ago + ' ago'">

				<div *ngIf="selectedPatch?.hash === patch.hash">
					<mat-progress-spinner
						*ngIf="patch.isLoading"
						[diameter]="60"
						color="accent"
						mode="indeterminate"
						style="margin: auto;">
					</mat-progress-spinner>

					<ngx-monaco-diff-editor
						style="height: calc(100vh - 105px)"
						*ngIf="patch.right.code || patch.left.code"
						[modifiedModel]="patch.right"
						[options]="editorOptions"
						[originalModel]="patch.left"
					></ngx-monaco-diff-editor>
				</div>
			</mat-tab>
		</mat-tab-group>
	</ng-container>
</div>
