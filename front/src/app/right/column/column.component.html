<div fxFlexFill fxLayout="column" fxLayoutAlign="space-between stretch">

	<div class="container" [formGroup]="form">

		<div *ngIf="form.get('old')" formGroupName="old" class="column">
			<div>
				<mat-form-field appearance="outline">
					<mat-label>Column Name</mat-label>
					<input formControlName="name"
						   autocomplete="off"
						   matInput>
				</mat-form-field>
			</div>
			<div class="type">
				<mat-form-field appearance="fill">
					<mat-label>Type</mat-label>
					<textarea
						cdkTextareaAutosize
						formControlName="type"
						matInput
						type="text">
					</textarea>
				</mat-form-field>
			</div>
			<mat-form-field *ngIf="extraAttributes.length" appearance="fill">
				<mat-label>Extras</mat-label>
				<mat-select formControlName="extra"
							multiple>
				</mat-select>
			</mat-form-field>
			<div class="nullable">
				<mat-slide-toggle
					formControlName="nullable"
					color="primary">
					Nullable
				</mat-slide-toggle>

				<mat-form-field>
					<mat-label>Default Value on Null</mat-label>
					<input formControlName="defaut"
						   autocomplete="off"
						   matInput>
				</mat-form-field>
			</div>
		</div>

		<div formArrayName="columns">
			<div *ngFor="let column of formColumn.controls; let i = index"
				 [formGroupName]="i"
				class="column mat-elevation-z4">

				<div>
					<mat-form-field appearance="outline">
						<mat-label>Column Name</mat-label>
						<input formControlName="name"
							   autocomplete="off"
							   matInput>
						<mat-error *ngIf="column.get('name')?.errors">
							Prefer alpha, numeric and "_", "-"
						</mat-error>
					</mat-form-field>

					<div>
						<button (click)="addColumn(column)"
								*ngIf="!form.get('old')"
								mat-icon-button
								matTooltip="Duplicate column"
								color="primary">
							<span class="material-symbols-outlined notranslate">
								content_copy
							</span>
						</button>

						<button (click)="formColumn.removeAt(i)"
								[disabled]="formColumn.controls.length <= 1"
								*ngIf="!form.get('old')"
								matTooltip="Remove column"
								mat-icon-button
								color="warn">
							<span class="material-symbols-outlined notranslate">
								remove
							</span>
						</button>
					</div>
				</div>

				<div class="type">
					<mat-form-field appearance="fill">
						<mat-label>Type</mat-label>
						<textarea
							cdkTextareaAutosize
							formControlName="type"
							matInput
							type="text">
						</textarea>
						<mat-error *ngIf="column.get('type')?.errors && column.get('type')!.errors!['required']">
							Type is required
						</mat-error>
						<mat-error *ngIf="column.get('type')?.errors && column.get('type')!.errors!['setLength']">
							Set a length or precision to your type
						</mat-error>
					</mat-form-field>

					<mat-select
						(selectionChange)="column.get('type')?.patchValue($event.value)">
						<mat-optgroup *ngFor="let group of selectedServer!.driver.language.typeGroups" [label]="group.name">
							<mat-option *ngFor="let type of group.list" [value]="type.id">
								<span
									[matTooltip]="type.description ? type.description : ''"
									matTooltipPosition="left"
									[style.color]="type.bold ? '#2196f3' : null">
									{{type.id}}
								</span>
							</mat-option>
						</mat-optgroup>
					</mat-select>
				</div>

				<mat-form-field *ngIf="extraAttributes.length" appearance="fill">
					<mat-label>Extras</mat-label>
					<mat-select formControlName="extra"
								disableOptionCentering
								multiple>
						<ng-container *ngFor="let ext of extraAttributes">
							<mat-option
								[value]="ext">
								{{ext}}
							</mat-option>
						</ng-container>
					</mat-select>
				</mat-form-field>

				<div class="nullable">
					<mat-slide-toggle
						#nullable
						formControlName="nullable"
						color="primary">
						Nullable
					</mat-slide-toggle>

					<mat-form-field [style.opacity]="nullable.checked ? 1 : 0.5">
						<mat-label>Default Value on Null</mat-label>
						<input formControlName="defaut"
							   autocomplete="off"
							   matInput>
					</mat-form-field>
				</div>

			</div>
		</div>
	</div>

	<div class="actions">
		<button (click)="addColumn()"
				*ngIf="!form.get('old')"
				color="primary"
				mat-stroked-button>
			<span class="material-symbols-outlined notranslate">
				add
			</span>
			Column
		</button>

		<a *ngIf="selectedServer"
		   [href]="selectedServer!.driver.docs.types"
		   mat-button
		   target="_blank">
			<span class="material-symbols-outlined notranslate">
				help
			</span>
			{{selectedServer.wrapper}} Data Types
		</a>
	</div>
</div>
